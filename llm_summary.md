# Spell Check - LLM Agent Summary

## Project Overview
Spell Check is a word-building puzzle game that combines chess mechanics with word creation. The game is built using Next.js 15.3, React, TypeScript, and Tailwind CSS.

## Recent Improvements (2025)
- **Puzzle Completion Tracking:** Solved puzzle IDs are tracked in localStorage for instant lookup and progress persistence.
- **Daily Puzzle Progress Refactor:** Daily puzzle progress logic is now handled via solved puzzle IDs; the daily page redirects to the next unsolved puzzle for today.
- **Completion Modal Improvements:** The modal now always appears for solved puzzles, supports replay, and only shows "Next Level" if available.
- **Client/Server Boundaries:** All localStorage and completion logic runs on the client; server components only load puzzle data.
- **UI/UX Tweaks:** Improved button colors, removed calendar icon, and enhanced modal and board responsiveness.
- **Legacy Code Cleanup:** Old level picker and unused play routes have been removed.

## Daily Puzzle Calendar
- Each day features three puzzles: short, medium, and long.
- Progress is tracked per puzzle; solved puzzles are remembered in the browser.
- The daily page automatically redirects to the next unsolved puzzle for today.
- See [src/data/calendar/README.md](src/data/calendar/README.md) for details on calendar structure and puzzle generation.

## Level Creation
- For custom level creation and board generation, see [src/level_creator/README.md](src/level_creator/README.md).

## Wordbank Management
- Wordbanks are JSON files in `src/data/wordbanks/`, generated by filtering large English word lists to remove short, plural, or invalid words.
- Each wordbank contains `unused_words` and `used_words` arrays to ensure no repeats.
- Words are moved between these lists as puzzles are generated or failed (if the word was from the wordbank).
- Filtering and merging scripts log all changes and reasons for exclusion.

## Puzzle Generation Pipeline
- Puzzles can be generated in two ways:
  1. **By word length:** A random unused word of the specified length is picked from the wordbank.
  2. **By explicit target word:** Any word can be specified directly (not affecting the wordbank).
- The board is generated to allow a unique path for the target word, with extra random letters added.
- Validation ensures the target word is the uniquely longest solution and has a unique solution path.
- If board generation or validation fails, the word is returned to the unused list (if it was from the wordbank), and the failed board is saved to `src/interesting/` for review.

## Puzzle Output & ID System
- Puzzles are saved to `src/puzzles/<wordLength>_letter/puzzle_<wordLength>-<extraLetters>-<nanoid>.json`.
- Each puzzle has a unique 7-character nanoID as part of its filename.
- Utility functions in `puzzleUtils.ts` handle ID generation, collision checking, and path resolution for programmatic use.

## Modular Structure
- `wordbankManager.ts`: Wordbank loading, selection, and updating.
- `boardGenerator.ts`: Board and path generation.
- `validator.ts`: Board validation and longest word search.
- `serializer.ts`: Puzzle serialization to JSON.
- `puzzleUtils.ts`: Puzzle ID and path utilities.

## Error Handling & Logging
- Failed boards are saved to `src/interesting/` with details for review.
- All wordbank changes and filtering steps are logged for transparency.

## Core Game Mechanics

### Board
- 5x5 chess board
- Each occupied square contains:
  1. A chess piece (either white or black)
  2. A letter in the top-right corner

### Move Rules
1. Players must make legal chess moves according to standard chess rules
2. Only capturing moves are allowed
3. Only pieces of the opposite color can be captured
4. Moves must be made in sequence to build valid English words
5. Words must match the target word for the level

### Special Rules
- Pawns:
  - Can only capture diagonally
  - White pawns move upward
  - Black pawns move downward

## Technical Architecture

### Key Components
- `ChessBoard.tsx`: Main game component, handles move validation, visual state, and completion logic
- `CompletionModal.tsx`: Reusable modal for puzzle completion, replay, and navigation
- `TutorialChessBoard.tsx` & `TutorialModal.tsx`: Tutorial-specific logic and UI
- `TutorialContext.tsx`: Manages tutorial state and progression
- `gameState.ts`: Handles solved puzzle tracking in localStorage
- `calendar.json`: Maps dates to daily puzzles (see [src/data/calendar/README.md](src/data/calendar/README.md))

### Client/Server Split
- Puzzle data is loaded on the server (Next.js server component)
- All localStorage and completion logic runs on the client
- UI and navigation are handled client-side for a seamless experience

## UI Elements
- Responsive chess board and word display
- Visual feedback for selection, legal moves, and errors
- Completion modal with Home, Next Level, and Play Again options
- Tutorial popups and highlighting

## Level Creator & Daily Puzzle Generation
- See [src/level_creator/README.md](src/level_creator/README.md) for board and puzzle generation details
- See [src/data/calendar/README.md](src/data/calendar/README.md) for daily puzzle calendar and generation script

## Changelog Highlights
- Puzzle completion tracking and daily progress refactor
- Improved completion modal and replay flow
- All localStorage and completion logic on the client
- UI/UX improvements and legacy code cleanup

## Development Setup
```bash
git clone https://github.com/EwanStephens/spellcheck.git
cd spellcheck
npm install
npm run dev
```
Server runs at http://localhost:3000

## Key Files

### Components
- `ChessBoard.tsx`: Main game component
- `TopBar.tsx`: Navigation header
- `TutorialChessBoard.tsx`: Tutorial-specific chess board
- `TutorialModal.tsx`: Tutorial instruction popups
- `CompletionModal.tsx`: Reusable level completion modal

### Contexts
- `TutorialContext.tsx`: Manages tutorial state and progression

### Utils
- `chess.ts`: Chess move validation logic
- `levelLoader.ts`: Level loading functionality
- `tutorialLoader.ts`: Tutorial level loading functionality
- `board.ts`: Board creation and manipulation

### Types
- `chess.ts`: Types for chess pieces and board state
- `level.ts`: Types for level data structure
- `tutorial.ts`: Types for tutorial system

### Data
- `src/tutorials/*.json`: JSON files for each tutorial level

### Assets
- `standard.js`: SVG chess piece definitions with responsive styling

## LLM-Specific Guidelines

### Move Validation
When validating moves, check:
1. Is the piece's movement pattern legal according to chess rules?
2. Is it a capturing move?
3. Is the captured piece of the opposite color?
4. Does the move contribute to a valid word sequence?

### Word Building Logic
1. Track letters from each captured piece
2. Concatenate letters in the order of capture
3. Validate against target word
4. Provide appropriate feedback for completion

### State Management Considerations
1. Board state must be updated after each move
2. Previous moves in current word sequence must be tracked
3. Visual feedback must be updated in real-time
4. Invalid moves must trigger appropriate error messages and visual cues

## Level Creator CLI (2025 Update)
- Now uses yargs for robust argument parsing
- Usage:
  - `--word-length <number>`: Pick a word of this length from the wordbank
  - `--word <targetWord>`: Use an explicit target word
  - `--extra-letters <number>`: (Optional, default 0) Add extra random letters
  - `--test`: (Optional) Dry run, no wordbank or file writes
- Exactly one of `--word-length` or `--word` must be specified
- No positional arguments are used

## Board Generation & Pawn Logic
- Board generator now uses `getPotentialEmptyCaptureSquares` for pathfinding and piece placement
- Pawn logic is now correct for both white and black pawns (diagonal, forward, and edge cases)
- Unit tests for chess utilities expanded and improved 

## Daily Puzzle Page Server/Client Split (2025 Update)
- The puzzle page (`src/app/puzzle/[puzzle]/page.tsx`) is a server component that loads puzzle data and determines the next puzzle in the daily sequence.
- It passes `nextPuzzleId` and a custom `congratsMessage` to the `ChessBoard` client component.
- `ChessBoard` displays the puzzle and, upon completion, shows the `CompletionModal`.
- `CompletionModal` uses the `nextPath` prop (from `nextPuzzleId`) to handle client-side navigation to the next puzzle, if available.
- This architecture keeps puzzle logic and data loading on the server, while UI and navigation are handled on the client for a seamless user experience.

## Analytics & Performance Monitoring

Spell Check integrates [Vercel Analytics](https://vercel.com/docs/analytics) and [Vercel Speed Insights](https://vercel.com/docs/speed-insights) for automatic analytics and performance tracking. These are enabled via the `@vercel/analytics` and `@vercel/speed-insights` packages in the root layout. No manual setup is required beyond deploying to Vercelâ€”metrics and insights are available in the Vercel dashboard. 